module.exports=function(e,n,t){var r=require("./util"),a=e.TimeoutError;function HandleWrapper(e){this.handle=e}HandleWrapper.prototype._resultCancelled=function(){clearTimeout(this.handle)};var afterValue=function(e){return i(+this).thenReturn(e)},i=e.delay=function(r,a){var i,o;return void 0!==a?(i=e.resolve(a)._then(afterValue,null,null,r,void 0),t.cancellation()&&a instanceof e&&i._setOnCancel(a)):(i=new e(n),o=setTimeout((function(){i._fulfill()}),+r),t.cancellation()&&i._setOnCancel(new HandleWrapper(o)),i._captureStackTrace()),i._setAsyncGuaranteed(),i};e.prototype.delay=function(e){return i(e,this)};function successClear(e){return clearTimeout(this.handle),e}function failureClear(e){throw clearTimeout(this.handle),e}e.prototype.timeout=function(e,n){var i,o;e=+e;var l=new HandleWrapper(setTimeout((function timeoutTimeout(){i.isPending()&&function(e,n,t){var i;i="string"!=typeof n?n instanceof Error?n:new a("operation timed out"):new a(n),r.markAsOriginatingFromRejection(i),e._attachExtraTrace(i),e._reject(i),null!=t&&t.cancel()}(i,n,o)}),e));return t.cancellation()?(o=this.then(),(i=o._then(successClear,failureClear,void 0,l,void 0))._setOnCancel(l)):i=this._then(successClear,failureClear,void 0,l,void 0),i}};