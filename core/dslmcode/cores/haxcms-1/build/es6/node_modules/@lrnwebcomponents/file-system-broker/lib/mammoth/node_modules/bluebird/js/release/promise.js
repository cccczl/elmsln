module.exports=function(){var makeSelfResolutionError=function(){return new l("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},reflectHandler=function(){return new Promise.PromiseInspection(this._target())},apiRejection=function(e){return Promise.reject(new l(e))};function Proxyable(){}var e,t={},i=require("./util");e=i.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},i.notEnumerableProp(Promise,"_getDomain",e);var r=require("./es5"),o=require("./async"),s=new o;r.defineProperty(Promise,"_async",{value:s});var n=require("./errors"),l=Promise.TypeError=n.TypeError;Promise.RangeError=n.RangeError;var a=Promise.CancellationError=n.CancellationError;Promise.TimeoutError=n.TimeoutError,Promise.OperationalError=n.OperationalError,Promise.RejectionError=n.OperationalError,Promise.AggregateError=n.AggregateError;var INTERNAL=function(){},c={},u={},_=require("./thenables")(Promise,INTERNAL),m=require("./promise_array")(Promise,INTERNAL,_,apiRejection,Proxyable),f=require("./context")(Promise),h=f.create,p=require("./debuggability")(Promise,f),d=(p.CapturedTrace,require("./finally")(Promise,_)),P=require("./catch_filter")(u),v=require("./nodeback"),y=i.errorObj,b=i.tryCatch;function Promise(e){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,e!==INTERNAL&&(!function check(e,t){if("function"!=typeof t)throw new l("expecting a function but got "+i.classString(t));if(e.constructor!==Promise)throw new l("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}(this,e),this._resolveFromExecutor(e)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function deferResolve(e){this.promise._resolveCallback(e)}function deferReject(e){this.promise._rejectCallback(e,!1)}function fillTypes(e){var t=new Promise(INTERNAL);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}return Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.caught=Promise.prototype.catch=function(e){var t=arguments.length;if(t>1){var r,o=new Array(t-1),s=0;for(r=0;r<t-1;++r){var n=arguments[r];if(!i.isObject(n))return apiRejection("expecting an object but got A catch statement predicate "+i.classString(n));o[s++]=n}return o.length=s,e=arguments[r],this.then(void 0,P(o,e,this))}return this.then(void 0,e)},Promise.prototype.reflect=function(){return this._then(reflectHandler,reflectHandler,void 0,this,void 0)},Promise.prototype.then=function(e,t){if(p.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+i.classString(e);arguments.length>1&&(r+=", "+i.classString(t)),this._warn(r)}return this._then(e,t,void 0,void 0,void 0)},Promise.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},Promise.prototype.spread=function(e){return"function"!=typeof e?apiRejection("expecting a function but got "+i.classString(e)):this.all()._then(e,void 0,void 0,c,void 0)},Promise.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},Promise.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new m(this).promise()},Promise.prototype.error=function(e){return this.caught(i.originatesFromRejection,e)},Promise.getNewLibraryCopy=module.exports,Promise.is=function(e){return e instanceof Promise},Promise.fromNode=Promise.fromCallback=function(e){var t=new Promise(INTERNAL);t._captureStackTrace();var i=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=b(e)(v(t,i));return r===y&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},Promise.all=function(e){return new m(e).promise()},Promise.cast=function(e){var t=_(e);return t instanceof Promise||((t=new Promise(INTERNAL))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},Promise.resolve=Promise.fulfilled=Promise.cast,Promise.reject=Promise.rejected=function(e){var t=new Promise(INTERNAL);return t._captureStackTrace(),t._rejectCallback(e,!0),t},Promise.setScheduler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+i.classString(e));return s.setScheduler(e)},Promise.prototype._then=function(t,r,o,n,l){var c=void 0!==l,u=c?l:new Promise(INTERNAL),_=this._target(),m=_._bitField;c||(u._propagateFrom(this,3),u._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&m)?this._boundValue():_===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,u));var f=e();if(0!=(50397184&m)){var h,p,d=_._settlePromiseCtx;0!=(33554432&m)?(p=_._rejectionHandler0,h=t):0!=(16777216&m)?(p=_._fulfillmentHandler0,h=r,_._unsetRejectionIsUnhandled()):(d=_._settlePromiseLateCancellationObserver,p=new a("late cancellation observer"),_._attachExtraTrace(p),h=r),s.invoke(d,_,{handler:null===f?h:"function"==typeof h&&i.domainBind(f,h),promise:u,receiver:n,value:p})}else _._addCallbacks(t,r,u,n,f);return u},Promise.prototype._length=function(){return 65535&this._bitField},Promise.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},Promise.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},Promise.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},Promise.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},Promise.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},Promise.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},Promise.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},Promise.prototype._isFinal=function(){return(4194304&this._bitField)>0},Promise.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},Promise.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},Promise.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},Promise.prototype._setAsyncGuaranteed=function(){s.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},Promise.prototype._receiverAt=function(e){var i=0===e?this._receiver0:this[4*e-4+3];if(i!==t)return void 0===i&&this._isBound()?this._boundValue():i},Promise.prototype._promiseAt=function(e){return this[4*e-4+2]},Promise.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},Promise.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},Promise.prototype._boundValue=function(){},Promise.prototype._migrateCallback0=function(e){e._bitField;var i=e._fulfillmentHandler0,r=e._rejectionHandler0,o=e._promise0,s=e._receiverAt(0);void 0===s&&(s=t),this._addCallbacks(i,r,o,s,null)},Promise.prototype._migrateCallbackAt=function(e,i){var r=e._fulfillmentHandlerAt(i),o=e._rejectionHandlerAt(i),s=e._promiseAt(i),n=e._receiverAt(i);void 0===n&&(n=t),this._addCallbacks(r,o,s,n,null)},Promise.prototype._addCallbacks=function(e,t,r,o,s){var n=this._length();if(n>=65531&&(n=0,this._setLength(0)),0===n)this._promise0=r,this._receiver0=o,"function"==typeof e&&(this._fulfillmentHandler0=null===s?e:i.domainBind(s,e)),"function"==typeof t&&(this._rejectionHandler0=null===s?t:i.domainBind(s,t));else{var l=4*n-4;this[l+2]=r,this[l+3]=o,"function"==typeof e&&(this[l+0]=null===s?e:i.domainBind(s,e)),"function"==typeof t&&(this[l+1]=null===s?t:i.domainBind(s,t))}return this._setLength(n+1),n},Promise.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},Promise.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(makeSelfResolutionError(),!1);var i=_(e,this);if(!(i instanceof Promise))return this._fulfill(e);t&&this._propagateFrom(i,2);var r=i._target();if(r!==this){var o=r._bitField;if(0==(50397184&o)){var s=this._length();s>0&&r._migrateCallback0(this);for(var n=1;n<s;++n)r._migrateCallbackAt(this,n);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&o))this._fulfill(r._value());else if(0!=(16777216&o))this._reject(r._reason());else{var l=new a("late cancellation observer");r._attachExtraTrace(l),this._reject(l)}}else this._reject(makeSelfResolutionError())}},Promise.prototype._rejectCallback=function(e,t,r){var o=i.ensureErrorObject(e),s=o===e;if(!s&&!r&&p.warnings()){var n="a promise was rejected with a non-error: "+i.classString(e);this._warn(n,!0)}this._attachExtraTrace(o,!!t&&s),this._reject(e)},Promise.prototype._resolveFromExecutor=function(e){var t=this;this._captureStackTrace(),this._pushContext();var i=!0,r=this._execute(e,(function(e){t._resolveCallback(e)}),(function(e){t._rejectCallback(e,i)}));i=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)},Promise.prototype._settlePromiseFromHandler=function(e,t,r,o){var s=o._bitField;if(0==(65536&s)){var n;o._pushContext(),t===c?r&&"number"==typeof r.length?n=b(e).apply(this._boundValue(),r):(n=y).e=new l("cannot .spread() a non-array: "+i.classString(r)):n=b(e).call(t,r);var a=o._popContext();0==(65536&(s=o._bitField))&&(n===u?o._reject(r):n===y?o._rejectCallback(n.e,!1):(p.checkForgottenReturns(n,a,"",o,this),o._resolveCallback(n)))}},Promise.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},Promise.prototype._followee=function(){return this._rejectionHandler0},Promise.prototype._setFollowee=function(e){this._rejectionHandler0=e},Promise.prototype._settlePromise=function(e,t,i,r){var o=e instanceof Promise,s=this._bitField,n=0!=(134217728&s);0!=(65536&s)?(o&&e._invokeInternalOnCancel(),i instanceof d&&i.isFinallyHandler()?(i.cancelPromise=e,b(t).call(i,r)===y&&e._reject(y.e)):t===reflectHandler?e._fulfill(reflectHandler.call(i)):i instanceof Proxyable?i._promiseCancelled(e):o||e instanceof m?e._cancel():i.cancel()):"function"==typeof t?o?(n&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,i,r,e)):t.call(i,r,e):i instanceof Proxyable?i._isResolved()||(0!=(33554432&s)?i._promiseFulfilled(r,e):i._promiseRejected(r,e)):o&&(n&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(r):e._reject(r))},Promise.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,i=e.promise,r=e.receiver,o=e.value;"function"==typeof t?i instanceof Promise?this._settlePromiseFromHandler(t,r,o,i):t.call(r,o,i):i instanceof Promise&&i._reject(o)},Promise.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},Promise.prototype._settlePromise0=function(e,t,i){var r=this._promise0,o=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,o,t)},Promise.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},Promise.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var i=makeSelfResolutionError();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():s.settlePromises(this))}},Promise.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return s.fatalError(e,i.isNode);(65535&t)>0?s.settlePromises(this):this._ensurePossibleRejectionHandled()}},Promise.prototype._fulfillPromises=function(e,t){for(var i=1;i<e;i++){var r=this._fulfillmentHandlerAt(i),o=this._promiseAt(i),s=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(o,r,s,t)}},Promise.prototype._rejectPromises=function(e,t){for(var i=1;i<e;i++){var r=this._rejectionHandlerAt(i),o=this._promiseAt(i),s=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(o,r,s,t)}},Promise.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var i=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,i,e),this._rejectPromises(t,i)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},Promise.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},Promise.defer=Promise.pending=function(){return p.deprecated("Promise.defer","new Promise"),{promise:new Promise(INTERNAL),resolve:deferResolve,reject:deferReject}},i.notEnumerableProp(Promise,"_makeSelfResolutionError",makeSelfResolutionError),require("./method")(Promise,INTERNAL,_,apiRejection,p),require("./bind")(Promise,INTERNAL,_,p),require("./cancel")(Promise,m,apiRejection,p),require("./direct_resolve")(Promise),require("./synchronous_inspection")(Promise),require("./join")(Promise,m,_,INTERNAL,s,e),Promise.Promise=Promise,Promise.version="3.4.7",require("./map.js")(Promise,m,apiRejection,_,INTERNAL,p),require("./call_get.js")(Promise),require("./using.js")(Promise,apiRejection,_,h,INTERNAL,p),require("./timers.js")(Promise,INTERNAL,p),require("./generators.js")(Promise,apiRejection,INTERNAL,_,Proxyable,p),require("./nodeify.js")(Promise),require("./promisify.js")(Promise,INTERNAL),require("./props.js")(Promise,m,_,apiRejection),require("./race.js")(Promise,INTERNAL,_,apiRejection),require("./reduce.js")(Promise,m,apiRejection,_,INTERNAL,p),require("./settle.js")(Promise,m,p),require("./some.js")(Promise,m,apiRejection),require("./filter.js")(Promise,INTERNAL),require("./each.js")(Promise,INTERNAL),require("./any.js")(Promise),i.toFastProperties(Promise),i.toFastProperties(Promise.prototype),fillTypes({a:1}),fillTypes({b:2}),fillTypes({c:3}),fillTypes(1),fillTypes((function(){})),fillTypes(void 0),fillTypes(!1),fillTypes(new Promise(INTERNAL)),p.setBounds(o.firstLineError,i.lastLineError),Promise};