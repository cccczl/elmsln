module.exports=function(e,n,r,t,o,a){var i,s=require("./util"),c=s.canEvaluate,l=s.tryCatch,u=s.errorObj;if(c){for(var thenCallback=function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))},promiseSetter=function(e){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,e))},generateHolderClass=function(n){for(var r=new Array(n),t=0;t<r.length;++t)r[t]="this.p"+(t+1);var a=r.join(" = ")+" = null;",i="var promise;\n"+r.map((function(e){return"                                                         \n                promise = "+e+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "})).join("\n"),s=r.join(", "),c="Holder$"+n,p="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return p=p.replace(/\[TheName\]/g,c).replace(/\[TheTotal\]/g,n).replace(/\[ThePassedArguments\]/g,s).replace(/\[TheProperties\]/g,a).replace(/\[CancellationCode\]/g,i),new Function("tryCatch","errorObj","Promise","async",p)(l,u,e,o)},p=[],h=[],f=[],d=0;d<8;++d)p.push(generateHolderClass(d+1)),h.push(thenCallback(d+1)),f.push(promiseSetter(d+1));i=function(e){this._reject(e)}}e.join=function(){var o,l=arguments.length-1;if(l>0&&"function"==typeof arguments[l]&&(o=arguments[l],l<=8&&c)){(w=new e(t))._captureStackTrace();for(var u=p[l-1],d=new u(o),m=h,v=0;v<l;++v){var y=r(arguments[v],w);if(y instanceof e){var _=(y=y._target())._bitField;0==(50397184&_)?(y._then(m[v],i,void 0,w,d),f[v](y,d),d.asyncNeeded=!1):0!=(33554432&_)?m[v].call(w,y._value(),d):0!=(16777216&_)?w._reject(y._reason()):w._cancel()}else m[v].call(w,y,d)}if(!w._isFateSealed()){if(d.asyncNeeded){var C=a();null!==C&&(d.fn=s.domainBind(C,d.fn))}w._setAsyncGuaranteed(),w._setOnCancel(d)}return w}for(var T=arguments.length,g=new Array(T),j=0;j<T;++j)g[j]=arguments[j];o&&g.pop();var w=new n(g).promise();return void 0!==o?w.spread(o):w}};