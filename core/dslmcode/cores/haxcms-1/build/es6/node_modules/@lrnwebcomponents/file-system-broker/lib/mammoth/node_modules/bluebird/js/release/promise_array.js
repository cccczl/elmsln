module.exports=function(e,t,r,i,s){var o=require("./util");o.isArray;function PromiseArray(r){var i=this._promise=new e(t);r instanceof e&&i._propagateFrom(r,3),i._setOnCancel(this),this._values=r,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return o.inherits(PromiseArray,s),PromiseArray.prototype.length=function(){return this._length},PromiseArray.prototype.promise=function(){return this._promise},PromiseArray.prototype._init=function init(t,s){var n=r(this._values,this._promise);if(n instanceof e){var l=(n=n._target())._bitField;if(this._values=n,0==(50397184&l))return this._promise._setAsyncGuaranteed(),n._then(init,this._reject,void 0,this,s);if(0==(33554432&l))return 0!=(16777216&l)?this._reject(n._reason()):this._cancel();n=n._value()}if(null!==(n=o.asArray(n)))0!==n.length?this._iterate(n):-5===s?this._resolveEmptyArray():this._resolve(function toResolutionValue(e){switch(e){case-2:return[];case-3:return{}}}(s));else{var a=i("expecting an array or an iterable object but got "+o.classString(n)).reason();this._promise._rejectCallback(a,!1)}},PromiseArray.prototype._iterate=function(t){var i=this.getActualLength(t.length);this._length=i,this._values=this.shouldCopyValues()?new Array(i):this._values;for(var s=this._promise,o=!1,n=null,l=0;l<i;++l){var a=r(t[l],s);n=a instanceof e?(a=a._target())._bitField:null,o?null!==n&&a.suppressUnhandledRejections():null!==n?0==(50397184&n)?(a._proxy(this,l),this._values[l]=a):o=0!=(33554432&n)?this._promiseFulfilled(a._value(),l):0!=(16777216&n)?this._promiseRejected(a._reason(),l):this._promiseCancelled(l):o=this._promiseFulfilled(a,l)}o||s._setAsyncGuaranteed()},PromiseArray.prototype._isResolved=function(){return null===this._values},PromiseArray.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},PromiseArray.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},PromiseArray.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},PromiseArray.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},PromiseArray.prototype._promiseCancelled=function(){return this._cancel(),!0},PromiseArray.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},PromiseArray.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var r=0;r<t.length;++r)t[r]instanceof e&&t[r].cancel()}},PromiseArray.prototype.shouldCopyValues=function(){return!0},PromiseArray.prototype.getActualLength=function(e){return e},PromiseArray};